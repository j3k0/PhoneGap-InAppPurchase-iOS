sudo: false
env:
  global:
    - TRAVIS_NODE_VERSION="8"
    - BUILD_DIR="/tmp/build-0"
    - BUNDLE_ID="cc.fovea.babygoo"
    - IAP_ID="babygooinapp1"
node_js:
  - "8"
  - "10"
matrix:
  include:
    #    # -------------
    #    #  osx
    #    # -------------
    #    # base osx test
    #    - env: PLATFORM=osx CORDOVA=9.0.0 CORDOVA_OSX=5.0.0
    #      os: osx
    #      osx_image: xcode10
    #      language: objective-c
    #    # test with xcode 9.3
    #    - env: PLATFORM=osx CORDOVA=9.0.0 CORDOVA_OSX=5.0.0
    #      os: osx
    #      osx_image: xcode9.3
    #      language: objective-c
    #    # test with older cordova and cordova-osx versions
    #    - env: PLATFORM=osx CORDOVA=8.1.2 CORDOVA_OSX=4.0.2
    #      os: osx
    #      osx_image: xcode10
    #      language: objective-c
    #    # -------------
    #    #  ios
    #    # -------------
    #    - env: PLATFORM=ios-12.1 CORDOVA=9.0.0 CORDOVA_IOS=5.0.1
    #      os: osx
    #      osx_image: xcode10
    #      language: objective-c
    #    - env: PLATFORM=ios-12.1 CORDOVA=8.1.2 CORDOVA_IOS=4.5.5
    #      os: osx
    #      osx_image: xcode10
    #      language: objective-c
    #    - env: PLATFORM=ios-12.1 CORDOVA=7.1.0 CORDOVA_IOS=4.5.5
    #      os: osx
    #      osx_image: xcode10
    #      language: objective-c
    #    - env: PLATFORM=ios-11.0 CORDOVA=9.0.0 CORDOVA_IOS=5.0.1
    #      os: osx
    #      osx_image: xcode10
    #      language: objective-c
    #    - env: PLATFORM=ios-11.0 CORDOVA=8.1.2 CORDOVA_IOS=4.5.5
    #      os: osx
    #      osx_image: xcode10
    #      language: objective-c
    #    - env: PLATFORM=ios-11.0 CORDOVA=7.1.0 CORDOVA_IOS=4.5.5
    #      os: osx
    #      osx_image: xcode10
    #      language: objective-c
    # -------------
    #  android
    # -------------
    - env: PLATFORM=android-4.4 CORDOVA=9.0.0 CORDOVA_ANDROID=8.0.0
      os: linux
      jdk: openjdk8
      language: android
      android:
        components:
          - tools
          - extra-android-m2repository
          - build-tools-28.0.3
          - platforms-android-28
    - env: PLATFORM=android-4.4 CORDOVA=9.0.0 CORDOVA_ANDROID=8.0.0
      os: linux
      jdk: openjdk8
      language: android
      android:
        components:
          - tools
          - extra-android-m2repository
          - build-tools-28.0.3
          - platforms-android-19
            #    - env: PLATFORM=android-4.4 CORDOVA=8.1.2 CORDOVA_ANDROID=7.1.4
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-26.0.2
            #          - android-26
            #    - env: PLATFORM=android-4.4 CORDOVA=7.1.0 CORDOVA_ANDROID=6.4.0
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-28.0.3
            #          - android-28
            #    - env: PLATFORM=android-5.1 CORDOVA=9.0.0 CORDOVA_ANDROID=8.0.0
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-22.0.1
            #          - android-22
            #    - env: PLATFORM=android-5.1 CORDOVA=8.1.2 CORDOVA_ANDROID=7.1.4
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-26.0.2
            #          - android-26
            #    - env: PLATFORM=android-5.1 CORDOVA=7.1.0 CORDOVA_ANDROID=6.4.0
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-28.0.3
            #          - android-22
            #          - android-28
            #    - env: PLATFORM=android-6.0 CORDOVA=9.0.0 CORDOVA_ANDROID=8.0.0
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-22.0.1
            #          - build-tools-26.0.2
            #          - build-tools-28.0.3
            #          - android-22
            #          - android-26
            #          - android-28
            #    - env: PLATFORM=android-6.0 CORDOVA=8.1.2 CORDOVA_ANDROID=7.1.4
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-28.0.3
            #          - android-23
            #    - env: PLATFORM=android-6.0 CORDOVA=7.1.0 CORDOVA_ANDROID=6.4.0
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-22.0.1
            #          - build-tools-26.0.2
            #          - build-tools-28.0.3
            #    - env: PLATFORM=android-7.0 CORDOVA=9.0.0 CORDOVA_ANDROID=8.0.0
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-22.0.1
            #          - build-tools-26.0.2
            #          - build-tools-28.0.3
            #    - env: PLATFORM=android-7.0 CORDOVA=8.1.2 CORDOVA_ANDROID=7.1.4
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-22.0.1
            #          - build-tools-26.0.2
            #          - build-tools-28.0.3
            #    - env: PLATFORM=android-7.0 CORDOVA=7.1.0 CORDOVA_ANDROID=6.4.0
            #      os: linux
            #      jdk: openjdk8
            #      language: android
            #      android:
            #        components:
            #          - tools
            #          - extra-android-m2repository
            #          - build-tools-22.0.1
            #          - build-tools-26.0.2
            #          - build-tools-28.0.3

before_install:
- rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh && nvm install $TRAVIS_NODE_VERSION
- node --version
- if [[ "$PLATFORM" =~ ios ]]; then npm install -g ios-deploy > /dev/null; fi
- if [[ "$PLATFORM" =~ android ]]; then
    gradle --version;
    mkdir -p "$ANDROID_HOME/licenses" || true;
    echo -e "\n24333f8a63b6825ea9c5514f83c2829b004d1fee" >> "$ANDROID_HOME/licenses/android-sdk-license";
    echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> "$ANDROID_HOME/licenses/android-sdk-license";
    echo -e "\nd56f5187479451eabf01fb78af6dfcb131a6481e" >> "$ANDROID_HOME/licenses/android-sdk-license";
    echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" >> "$ANDROID_HOME/licenses/android-sdk-preview-license";
    yes | sdkmanager --update;
    yes | sdkmanager --licenses;
  fi
- npm install -g "cordova@$CORDOVA" > /dev/null

install:
- npm install > /dev/null

script:
  - export ROOT_DIR="$(pwd)"
  - make all
  - rm -fr "$BUILD_DIR"
  - cd test && cordova create "$BUILD_DIR" "$BUNDLE_ID" Test
  - cp src/css/* "$BUILD_DIR/www/css/"
  - cp src/js/* "$BUILD_DIR/www/js/"
  - cp src/index.html "$BUILD_DIR/www/"
  - cd "$BUILD_DIR"
  - sed --in-place=.bak "s/babygooinapp1/$IAP_ID/g" "www/js/iap.js" || sed -i bak "s/babygooinapp1/$IAP_ID/g" "$BUILD_DIR/www/js/iap.js"
  - if [[ "$PLATFORM" =~ ios ]]; then cordova platform add ios@$CORDOVA_IOS; fi
  - if [[ "$PLATFORM" =~ osx ]]; then cordova platform add osx@$CORDOVA_OSX; fi
  - if [[ "$PLATFORM" =~ android ]]; then cordova platform add android@$CORDOVA_ANDROID; fi
  - cordova plugin add "$ROOT_DIR" --variable BILLING_KEY=0123456789abcdef
  - rsync -r "$ROOT_DIR"/src/android/ plugins/cc.fovea.cordova.purchase/src/android
  - cp "$ROOT_DIR"/src/ios/*.[hm] plugins/cc.fovea.cordova.purchase/src/ios/
  - cp "$ROOT_DIR"/www/*.js plugins/cc.fovea.cordova.purchase/www/
  - cordova plugin add https://github.com/apache/cordova-plugin-console.git
  - cordova build --debug 2>&1
